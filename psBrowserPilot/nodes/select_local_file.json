{
    "id":  "select_local_file",
    "label":  "Select Local File",
    "category":  "Custom",
    "execution":  "ui",
    "inputs":  [

               ],
    "outputs":  [
                    "FullName"
                ],
    "constants":  [
                      {
                          "key":  "FullName",
                          "type":  "TextBox",
                          "value":  "\u0027\u0027"
                      }
                  ],
    "chainExecution":  false,
    "script":  "{{ output.FullName }} = {{ config.FullName }}\n{{ output.FullName }}",
    "ui":  {
               "markup":  "\u003cdiv class=\"custom-ui-node file-dialog-node\"\u003e\n  \u003cdiv class=\"file-dialog-actions\"\u003e\n    \u003cbutton type=\"button\" data-role=\"open\"\u003eファイルを選択\u003c/button\u003e\n    \u003cbutton type=\"button\" data-role=\"clear\" class=\"secondary\"\u003eクリア\u003c/button\u003e\n  \u003c/div\u003e\n  \u003cdiv class=\"file-dialog-path\" data-path\u003eファイルが未選択です\u003c/div\u003e\n  \u003cdiv class=\"file-dialog-status\" data-status\u003e\u003c/div\u003e\n\u003c/div\u003e",
               "script":  "const { node, controls, updateConfig, toPowerShellLiteral, helpers } = context;\nif (!controls) {\n  return;\n}\nconst openButton = controls.querySelector(\u0027[data-role=\"open\"]\u0027);\nconst clearButton = controls.querySelector(\u0027[data-role=\"clear\"]\u0027);\nconst pathLabel = controls.querySelector(\u0027[data-path]\u0027);\nconst statusLabel = controls.querySelector(\u0027[data-status]\u0027);\nconst bridge = helpers?.NodeBridge;\nconst logger = helpers?.NodeLogger || console;\nlet disposed = false;\nconst setStatus = (message, state = \u0027\u0027) =\u003e {\n  if (disposed || !statusLabel) {\n    return;\n  }\n  statusLabel.textContent = message || \u0027\u0027;\n  if (state) {\n    statusLabel.dataset.state = state;\n  } else {\n    delete statusLabel.dataset.state;\n  }\n};\nconst applyPath = (rawPath, { announce = true } = {}) =\u003e {\n  if (disposed) {\n    return;\n  }\n  const value = rawPath || \u0027\u0027;\n  updateConfig(\u0027FullName__raw\u0027, value, { silent: true });\n  updateConfig(\u0027FullName\u0027, value ? toPowerShellLiteral(value) : \u0027\u0027, { silent: false });\n  if (pathLabel) {\n    pathLabel.textContent = value || \u0027ファイルが未選択です\u0027;\n    if (value) {\n      pathLabel.dataset.state = \u0027selected\u0027;\n    } else {\n      pathLabel.dataset.state = \u0027empty\u0027;\n    }\n  }\n  if (clearButton) {\n    clearButton.disabled = !value;\n  }\n  if (announce) {\n    setStatus(value ? \u0027ファイルを選択しました。\u0027 : \u0027ファイルをクリアしました。\u0027, value ? \u0027success\u0027 : \u0027info\u0027);\n  }\n};\napplyPath(node?.config?.FullName__raw || \u0027\u0027, { announce: false });\nconst buildScript = () =\u003e [\n  \u0027Add-Type -AssemblyName System.Windows.Forms\u0027,\n  \u0027Add-Type -AssemblyName System.Drawing\u0027,\n  \u0027$dialog = New-Object System.Windows.Forms.OpenFileDialog\u0027,\n  \u0027$dialog.Filter = \"すべてのファイル (*.*)|*.*\"\u0027,\n  \u0027if ($dialog.ShowDialog() -eq [System.Windows.Forms.DialogResult]::OK) {\u0027,\n  \u0027  @{ ok = $true; fullName = $dialog.FileName } | ConvertTo-Json -Compress\u0027,\n  \u0027} else {\u0027,\n  \u0027  @{ ok = $false; cancelled = $true } | ConvertTo-Json -Compress\u0027,\n  \u0027}\u0027\n].join(\u0027\\n\u0027);\nconst handleOpen = async () =\u003e {\n  if (!bridge?.requestJson) {\n    setStatus(\u0027PowerShell ブリッジが利用できません。\u0027, \u0027error\u0027);\n    return;\n  }\n  if (openButton) {\n    openButton.disabled = true;\n  }\n  setStatus(\u0027ダイアログを開いています…\u0027, \u0027pending\u0027);\n  try {\n    const result = await bridge.requestJson(buildScript());\n    if (disposed) {\n      return;\n    }\n    if (!result) {\n      throw new Error(\u0027PowerShell から応答がありません。\u0027);\n    }\n    if (result.ok \u0026\u0026 result.fullName) {\n      applyPath(result.fullName);\n    } else if (result.cancelled) {\n      setStatus(\u0027キャンセルしました。\u0027, \u0027info\u0027);\n    } else {\n      const errorMessage = result.error || \u0027ファイルを取得できませんでした。\u0027;\n      throw new Error(errorMessage);\n    }\n  } catch (error) {\n    if (!disposed) {\n      setStatus(`失敗しました: ${error?.message || error}`, \u0027error\u0027);\n      logger?.error?.(\u0027File selection failed\u0027, error);\n    }\n  } finally {\n    if (!disposed \u0026\u0026 openButton) {\n      openButton.disabled = false;\n    }\n  }\n};\nconst handleClear = () =\u003e {\n  applyPath(\u0027\u0027, { announce: true });\n};\nopenButton?.addEventListener(\u0027click\u0027, handleOpen);\nclearButton?.addEventListener(\u0027click\u0027, handleClear);\nreturn () =\u003e {\n  disposed = true;\n  openButton?.removeEventListener(\u0027click\u0027, handleOpen);\n  clearButton?.removeEventListener(\u0027click\u0027, handleClear);\n};",
               "style":  ".file-dialog-node {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.file-dialog-actions {\n  display: flex;\n  gap: 0.5rem;\n}\n.file-dialog-actions button {\n  padding: 0.4rem 0.9rem;\n  border-radius: 0.5rem;\n  border: none;\n  cursor: pointer;\n  background: #2563eb;\n  color: #fff;\n}\n.file-dialog-actions button.secondary {\n  background: #f3f4f6;\n  color: #111827;\n}\n.file-dialog-actions button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n.file-dialog-path {\n  min-height: 1.5rem;\n  padding: 0.35rem 0.5rem;\n  border-radius: 0.5rem;\n  background: rgba(59, 130, 246, 0.12);\n  word-break: break-all;\n  font-family: var(--font-family-mono, Consolas, \u0027Courier New\u0027, monospace);\n}\n.file-dialog-path[data-state=\u0027empty\u0027] {\n  color: #6b7280;\n  background: #f9fafb;\n}\n.file-dialog-status {\n  min-height: 1.25rem;\n  font-size: 0.85rem;\n  color: #4b5563;\n}\n.file-dialog-status[data-state=\u0027success\u0027] {\n  color: #047857;\n}\n.file-dialog-status[data-state=\u0027error\u0027] {\n  color: #dc2626;\n}\n.file-dialog-status[data-state=\u0027pending\u0027] {\n  color: #1d4ed8;\n}\n.file-dialog-status[data-state=\u0027info\u0027] {\n  color: #0f172a;\n}"
           },
    "description":  "",
    "createdAt":  "2024-05-10T00:00:00.000Z",
    "updatedAt":  "2025-11-07T17:02:48.367Z"
}